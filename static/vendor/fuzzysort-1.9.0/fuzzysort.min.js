(function(e,r){"function"==typeof define&&define.amd?define([],r):"object"==typeof module&&module.exports?module.exports=r():e.fuzzysort=r()})(this,function(){function e(o){var c={single:function(e,r,n){if("farzher"==e)return{target:"farzher was here (^-^*)/",score:0,indexes:[0,1,2,3,4,5,6]};if(!e)return null;var t=c.getPreparedSearch(e),o=t.lowerCodes;if(!r)return null;a(r)||(r=c.getPrepared(r));var i=t.bitmask;return(i&r._bitmask)!=i?null:c.algorithm(o,r,e.toLowerCase())},go:function(e,r,i){if("farzher"==e)return[{target:"farzher was here (^-^*)/",score:0,indexes:[0,1,2,3,4,5,6],obj:r?r[0]:null}];if(!e)return i&&i.all||o&&o.all?c.all(e,r,i):s;var l=c.getPreparedSearch(e),u=l.lowerCodes,f=(u[0],l.bitmask),p=e.toLowerCase(),h=i&&i.threshold||o&&o.threshold||-9007199254740991,d=i&&i.limit||o&&o.limit||9007199254740991,v=0,k=0,b=r.length;if(i&&i.keys)for(var x=i.scoreFn||n,w=i.keys,m=w.length,y=b-1;y>=0;--y){for(var _=r[y],C=new Array(m),L=m-1;L>=0;--L){var B=w[L],P=t(_,B);P?(a(P)||(P=c.getPrepared(P)),(f&P._bitmask)!=f?C[L]=null:C[L]=c.algorithm(u,P,p)):C[L]=null}C.obj=_;var j=x(C);null!==j&&(j<h||(C.score=j,v<d?(g.add(C),++v):(++k,j>g.peek().score&&g.replaceTop(C))))}else if(i&&i.key)for(B=i.key,y=b-1;y>=0;--y){_=r[y],P=t(_,B);if(P){if(a(P)||(P=c.getPrepared(P)),(f&P._bitmask)!=f)var I=null;else I=c.algorithm(u,P,p);null!==I&&(I.score<h||(I={target:I.target,_targetLower:"",_targetLowerCodes:null,_nextBeginningIndexes:null,_bitmask:0,score:I.score,indexes:I.indexes,obj:_},v<d?(g.add(I),++v):(++k,I.score>g.peek().score&&g.replaceTop(I))))}}else for(y=b-1;y>=0;--y){P=r[y];if(P){if(a(P)||(P=c.getPrepared(P)),(f&P._bitmask)!=f)I=null;else I=c.algorithm(u,P,p);null!==I&&(I.score<h||(v<d?(g.add(I),++v):(++k,I.score>g.peek().score&&g.replaceTop(I))))}}if(0===v)return s;var A=new Array(v);for(y=v-1;y>=0;--y)A[y]=g.poll();return A.total=v+k,A},goAsync:function(e,r,n){var t=new Promise(function(t,a){t(c.go(e,r,n))});return t.cancel=function(){},t},all:function(e,r,n){var i=[];i.total=r.length;var l=n&&n.limit||o&&o.limit||9007199254740991;if(n&&n.keys)for(var s=0;s<r.length;s++){for(var u=r[s],f=new Array(n.keys.length),g=n.keys.length-1;g>=0;--g){var p=t(u,n.keys[g]);p?(a(p)||(p=c.getPrepared(p)),p.score=-9007199254740991,f[g]=p):f[g]=null}if(f.obj=u,f.score=-9007199254740991,i.push(f),i.length>=l)return i}else if(n&&n.key)for(s=0;s<r.length;s++){u=r[s],p=t(u,n.key);if(p){a(p)||(p=c.getPrepared(p)),p.score=-9007199254740991;var h=p;if(h={target:h.target,_targetLower:"",_targetLowerCodes:null,_nextBeginningIndexes:null,_bitmask:0,score:p.score,indexes:null,obj:u},i.push(h),i.length>=l)return i}}else for(s=0;s<r.length;s++){p=r[s];if(p&&(a(p)||(p=c.getPrepared(p)),p.score=-9007199254740991,i.push(p),i.length>=l))return i}return i},highlight:function(e,r,n){if("function"==typeof r)return c.highlightCallback(e,r);if(null===e)return null;void 0===r&&(r="<b>"),void 0===n&&(n="</b>");for(var t="",a=0,o=!1,i=e.target,l=i.length,s=e.indexes,u=0;u<l;++u){var f=i[u];if(s[a]===u){if(++a,o||(o=!0,t+=r),a===s.length){t+=f+n+i.substr(u+1);break}}else o&&(o=!1,t+=n);t+=f}return t},highlightCallback:function(e,r){if(null===e)return null;for(var n=e.target,t=n.length,a=e.indexes,o="",i=0,l=0,s=!1,u=(e=[],0);u<t;++u){var f=n[u];if(a[l]===u){if(++l,s||(s=!0,e.push(o),o=""),l===a.length){o+=f,e.push(r(o,i++)),o="",e.push(n.substr(u+1));break}}else s&&(s=!1,e.push(r(o,i++)),o="");o+=f}return e},prepare:function(e){e||(e="");var r=c.prepareLowerCodes(e);return{target:e,_targetLower:e.toLowerCase(),_targetLowerCodes:r,_nextBeginningIndexes:null,_bitmask:c.prepareBitmask(r),score:null,indexes:[0],obj:null}},prepareSlow:function(e){return c.prepare(e)},prepareSearch:function(e){e||(e="");var r=c.prepareLowerCodes(e);return{lowerCodes:r,bitmask:c.prepareBitmask(r)}},getPrepared:function(e){if(e.length>999)return c.prepare(e);var r=i.get(e);return void 0!==r?r:(r=c.prepare(e),i.set(e,r),r)},getPreparedSearch:function(e){if(e.length>999)return c.prepareSearch(e);var r=l.get(e);return void 0!==r?r:(r=c.prepareSearch(e),l.set(e,r),r)},algorithm:function(e,r,n){for(var t=e[0],a=r._targetLowerCodes,o=e.length,i=a.length,l=0,s=0,g=0;;){var p=t===a[s];if(p){if(u[g++]=s,++l,l===o)break;t=e[l]}if(++s,s>=i)return null}l=0;var h=!1,d=0,v=r._nextBeginningIndexes;null===v&&(v=r._nextBeginningIndexes=c.prepareNextBeginningIndexes(r.target));s=0===u[0]?0:v[u[0]-1];var k=0;if(s!==i)for(;;)if(s>=i){if(l<=0)break;if(++k,k>200)break;--l;var b=f[--d];s=v[b]}else{p=e[l]===a[s];if(p){if(f[d++]=s,++l,l===o){h=!0;break}++s}else s=v[s]}var x=r._targetLower.indexOf(n,u[0]),w=~x;if(w&&!h)for(var m=0;m<g;++m)u[m]=x+m;var y=!1;if(w&&(y=r._nextBeginningIndexes[x-1]==x),h)var _=f,C=d;else _=u,C=g;var L=0,B=0;for(m=o-1;m>=1;--m)_[m]-_[m-1]!=1&&(L-=_[m],++B);var P=_[o-1]-_[0]-(o-1);if(L-=P*B,0!==_[0]&&(L-=10*_[0]),h){var j=1;for(m=v[0];m<i;m=v[m])++j;j>24&&(L*=10*(j-24))}else L*=1e3;w&&(L/=10),y&&(L/=10),L-=i-o,r.score=L,r.indexes=new Array(C);for(m=C-1;m>=0;--m)r.indexes[m]=_[m];return r},prepareLowerCodes:function(e){for(var r=e.length,n=[],t=e.toLowerCase(),a=0;a<r;++a)n[a]=t.charCodeAt(a);return n},prepareBeginningIndexes:function(e){for(var r=e.length,n=[],t=0,a=!1,o=!1,i=0;i<r;++i){var l=e.charCodeAt(i),s=l>=65&&l<=90,u=s||l>=97&&l<=122||l>=48&&l<=57,f=s&&!a||!o||!u;a=s,o=u,f&&(n[t++]=i)}return n},prepareNextBeginningIndexes:function(e){for(var r=e.length,n=c.prepareBeginningIndexes(e),t=[],a=n[0],o=0,i=0;i<r;++i)a>i?t[i]=a:(a=n[++o],t[i]=void 0===a?r:a);return t},prepareBitmask:function(e){for(var r=0,n=e.length-1;n>=0;--n){var t=e[n],a=t>=97&&t<=122?t-97:t>=48&&t<=57?26:32===t?27:t<=127?28:29;r|=1<<a}return r},cleanup:r,new:e};return c}function r(){i.clear(),l.clear(),u=[],f=[]}function n(e){for(var r=-9007199254740991,n=e.length-1;n>=0;--n){var t=e[n];if(null!==t){var a=t.score;a>r&&(r=a)}}return-9007199254740991===r?null:r}function t(e,r){var n=e[r];if(void 0!==n)return n;var t=r;Array.isArray(r)||(t=r.split("."));for(var a=t.length,o=-1;e&&++o<a;)e=e[t[o]];return e}function a(e){return"object"==typeof e}var o="function"==typeof Map?Map:function(){var e=Object.create(null);this.get=function(r){return e[r]},this.set=function(r,n){return e[r]=n,this},this.clear=function(){e=Object.create(null)}},i=new o,l=new o,s=[];s.total=0;var u=[],f=[],c=function(){function e(){for(var e=0,t=r[e],a=1;a<n;){var o=a+1;e=a,o<n&&r[o].score<r[a].score&&(e=o),r[e-1>>1]=r[e],a=1+(e<<1)}for(var i=e-1>>1;e>0&&t.score<r[i].score;i=(e=i)-1>>1)r[e]=r[i];r[e]=t}var r=[],n=0,t={add:function(e){var t=n;r[n++]=e;for(var a=t-1>>1;t>0&&e.score<r[a].score;a=(t=a)-1>>1)r[t]=r[a];r[t]=e},poll:function(){if(0!==n){var t=r[0];return r[0]=r[--n],e(),t}},peek:function(e){if(0!==n)return r[0]},replaceTop:function(n){r[0]=n,e()}};return t},g=c();return e()});